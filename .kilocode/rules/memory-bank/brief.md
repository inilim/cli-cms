# CLI-CMS Project Brief

## Project Overview
CLI-CMS - это минималистичная система управления содержимым (CMS), которая работает без веб-сервера. Все эндпоинты запускаются через командную строку (CLI). Основная точка входа в приложение - файл index.php. Система использует архитектурный подход, близкий к MVC паттерну, с использованием DI-контейнера для управления зависимостями. В системе реализована поддержка структурированного контента в формате Editor.js с обработкой различных типов блоков (заголовки, параграфы, списки, цитаты, код и др.) через сервис `BlockProcessingService` и шаблоны Twig.

## Core Features
- Работа исключительно через CLI (без веб-сервера)
- Использование PHP 8.4 в качестве основного языка программирования
- Использование SQLite в качестве СУБД
- Кроссплатформенная совместимость (разработка на Windows, запуск на Ubuntu)
- Поддержка структурированного контента в формате JSON (например, Editor.js)
- Шаблонизация через Twig для генерации HTML-контента в CLI-приложении
- Поддержка специфичных функций SQLite (CRC_32, UNIX_MS)
- Использование модификатора `protected(set)` для свойств сущностей

## Technology Stack
- Язык программирования: PHP 8.4
- База данных: SQLite
- Архитектура: близкая к MVC с DI-контейнером
- Фреймворки: не используются, только простые библиотеки из composer.json
- Нативный PHP код с минимальным использованием сторонних решений
- Зависимости: inilim/tools, inilim/ipdo, inilim/env, inilim/di, twig/twig

## Architecture
- Архитектурный подход: близкий к MVC паттерну с использованием DI-контейнера
- Организация кода: структурированная с использованием пространств имен
- Точка входа: index.php → boot.php
- Обработка запросов: через CLI-интерфейс
- Шаблонизация: Twig 3.x через TwigRenderService
- Обработка контента: сервис `BlockProcessingService` для обработки JSON-контента из Editor.js
- Сущности: использование модификатора `protected(set)` для контроля доступа к свойствам

## Project Structure
- src/ - основной каталог с исходным кодом
- src/Bind/ - компоненты привязки (связывания)
- src/Controller/ - контроллеры приложения
- src/Entity/ - сущности приложения
- src/Enum/ - перечисления
- src/Exception/ - исключения
- src/Repository/ - репозитории для работы с данными
- src/Service/ - сервисы приложения
- files/ - директория для хранения данных (база данных, логи, шаблоны)
- files/db/ - место хранения SQLite базы данных
- files/templates/ - шаблоны для Twig (включая подкаталоги blocks/ и styles/)
- files/cache/ - директория для кэширования (включая twig/)
- files/sql/ - SQL-скрипты для создания таблиц
- files/other/examples/ - примеры структурированного контента

## Development Environment
- Разработка: Windows OS
- Эксплуатация: Ubuntu OS
- Управление зависимостями: Composer
- Контроль версий: Git

## Class Naming Conventions

- Имена классов пишутся в **PascalCase** (UpperCamelCase): `UserService`, `OrderController`.
- Суффиксы/префиксы по типу класса обязательны и единообразны:
  - Контроллеры: `*Controller` (например, `UserController`).
  - Исключения: `*Exception` (например, `ValidationException`).
  - Перечисления: `*Enum` (например, `StatusEnum`).
  - Репозиторий: `*Repository` (например, `RecordRepository`).
- Абстрактные/базовые классы явно помечаются: `*Abstract`.

## Visibility rules (PHP)

- Не использовать приватную инкапсуляцию: ключевое слово `private` запрещено для свойств, методов и констант.
- Вместо `private` всегда использовать `protected`, чтобы обеспечить расширяемость и переиспользование в наследниках.
- Для публичных методов требуется опускать модификатор доступа: если метод публичный, ключевое слово `public` можно не указывать.

## Статический анализ phpstan

Статанализ выдает ошибки из-за библиотеки inilim/tools, дело в том что методы из библиотеки вызываются через магический метод __callStatic. Анализатор не видит stub классы внутри библиотеки, если такие ошибки будут, то добавляй типы через комментарии, пример ниже
```php
$str = \Inilim\Tool\Str::finish($str);
/** @var string $str */
```

## HTML/CSS/Twig

- При любом изменении разметки, особенно при удалении элемента/блока, обязательно выполняй проверку связанных CSS-стилей.
- CSS стили для шаблонов сохраняй отдельным шаблоном, для этого есть соответствующая директория.
- Не используй HTML атрибут "id", вместо него используй "data-id"